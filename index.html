<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>LOS COMPASITOS GACHA</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #1a1a1a, #333);
    color: white;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    height: 100vh;
    flex-direction: column;
    padding-top: 30px;
  }
  h1 { text-align: center; font-size: 2em; color: gold; text-shadow: 2px 2px 4px black; margin-bottom: 10px; }
  #eventoActivo { text-align: center; margin-bottom: 10px; font-size: 1.2em; color: cyan; }
  #luckActivo { text-align: center; margin-bottom: 10px; font-size: 1.2em; color: orange; }
  #resultado { margin-top: 20px; font-size: 1.5em; padding: 15px; border-radius: 10px; text-align: center; min-height: 40px; }
  button {
    padding: 15px 30px;
    font-size: 1.2em;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    background: #4CAF50;
    color: white;
    transition: 0.3s;
    align-self: center;
    margin-top: 10px;
  }
  button:hover { background: #45a049; }
  .Comun { color: lightgray; }
  .Raro { color: purple; }
  .M√≠tico { color: red; font-weight: bold; }
  #historial { margin-top: 30px; max-height: 200px; overflow-y: auto; border-top: 1px solid white; padding-top: 10px; }
  #historial h2 { margin-bottom: 10px; font-size: 1.2em; }
  #historial ul { list-style: none; padding-left: 0; }
  #historial li { margin-bottom: 5px; font-size: 1em; }
</style>
</head>
<body>

<h1>LOS COMPASITOS GACHA</h1>
<div id="eventoActivo"></div>
<div id="luckActivo"></div>

<button id="btnGirar" onclick="girar()">Girar</button>
<button id="btnAdmin" onclick="abrirPanel()">Panel de administraci√≥n</button>

<div id="resultado"></div>

<div id="historial">
  <h2>Historial de tus premios:</h2>
  <ul id="historial-list"></ul>
</div>

<script>
// ITEMS BASE
const items = [
  { nombre: "Sticker", rareza: "Comun", prob: 0.4899 },
  { nombre: "Nada", rareza: "Comun", prob: 0.4899 },
  { nombre: "Ayuda con algo", rareza: "Raro", prob: 0.01 },
  { nombre: "Fruta Perma en Invierno", rareza: "M√≠tico", prob: 0.0001 }
];

// CONFIGURACI√ìN PERSISTENTE
let config = JSON.parse(localStorage.getItem("gachaConfig") || "{}");

let luckMultiplier = config.luckMultiplier || 1;
let luckEndTime = config.luckEndTime || null;
let gachaActivo = config.gachaActivo !== undefined ? config.gachaActivo : true;
let cooldownActivo = config.cooldownActivo !== undefined ? config.cooldownActivo : true;
let cooldownTiempo = 45*60*1000;
let eventoNombre = config.eventoNombre || "";

// ELEMENTOS
const btnGirar = document.getElementById("btnGirar");
const eventoDiv = document.getElementById("eventoActivo");
const luckDiv = document.getElementById("luckActivo");

// ACTUALIZAR UI SEG√öN CONFIG
function actualizarUI(){
  if(!gachaActivo){
    btnGirar.style.display = "none";
    eventoDiv.innerHTML = "<span style='color:red;'>‚ùå No Hay Eventos Activos</span>";
  } else {
    btnGirar.style.display = "block";
    eventoDiv.innerText = eventoNombre ? "Evento Activo: "+eventoNombre : "";
  }
}
actualizarUI();

// CALCULAR PROBABILIDADES CON LUCK
function calcularProbabilidades(){
  let probTotal = 0;
  let newProbs = [];
  items.forEach(item=>{
    let prob = item.prob;
    if(item.rareza === "Raro" || item.rareza === "M√≠tico"){
      prob *= luckMultiplier; // xLuck aumenta probabilidad
    }
    newProbs.push(prob);
    probTotal += prob;
  });
  // Normalizar
  newProbs = newProbs.map(p=>p/probTotal);
  return newProbs;
}

// OBTENER RESULTADO FINAL
function obtenerResultado(){
  let probs = calcularProbabilidades();
  let rand = Math.random();
  let acumulado = 0;
  let finalItem;
  for(let i=0;i<items.length;i++){
    acumulado += probs[i];
    if(rand <= acumulado){
      finalItem = items[i];
      break;
    }
  }
  if(!finalItem) finalItem = items[0];
  return finalItem;
}

// FUNCION GIRAR
function girar(){
  const resultadoDiv = document.getElementById("resultado");
  if(!gachaActivo){
    resultadoDiv.innerHTML = "<span style='color:red;'>‚ùå No Hay Eventos Activos</span>";
    return;
  }

  let historial = JSON.parse(localStorage.getItem("historialGacha") || "[]");

  if(cooldownActivo){
    let lastSpin = localStorage.getItem("lastSpin");
    let now = Date.now();
    if(lastSpin && now - lastSpin < cooldownTiempo){
      let restante = Math.ceil((cooldownTiempo - (now - lastSpin)) / 60000);
      resultadoDiv.innerText = "‚è≥ Espera " + restante + " minutos para girar de nuevo.";
      return;
    }
    localStorage.setItem("lastSpin", Date.now());
  }

  // ANIMACION TIPO GACHA
  let vueltas = 20;
  let i=0;
  const animacion = setInterval(()=>{
    let randomItem = items[Math.floor(Math.random()*items.length)];
    resultadoDiv.innerHTML = `<span class="${randomItem.rareza}">${randomItem.nombre}</span>`;
    i++;
    if(i>=vueltas){
      clearInterval(animacion);
      let finalItem = obtenerResultado();
      resultadoDiv.innerHTML=`üéÅ Has obtenido: <span class="${finalItem.rareza}">${finalItem.nombre}</span> (${finalItem.rareza})`;
      historial.unshift({nombre: finalItem.nombre, rareza: finalItem.rareza, fecha:new Date().toLocaleString()});
      localStorage.setItem("historialGacha", JSON.stringify(historial));
      mostrarHistorial();
    }
  },100);
}

// HISTORIAL
function mostrarHistorial(){
  let historial = JSON.parse(localStorage.getItem("historialGacha") || "[]");
  let lista = document.getElementById("historial-list");
  lista.innerHTML="";
  historial.forEach(item=>{
    let li = document.createElement("li");
    li.innerHTML = `[${item.fecha}] <span class="${item.rareza}">${item.nombre}</span> (${item.rareza})`;
    lista.appendChild(li);
  });
}

// PANEL ADMIN
function abrirPanel(){
  let pass = prompt("Inserta la contrase√±a:");
  if(pass!=="HolaXD"){ alert("Contrase√±a incorrecta"); return; }

  let opcion = prompt(
    "Elige opci√≥n:\n"+
    "1. x2 Luck\n2. x4 Luck\n3. x6 Luck\n4. x8 Luck\n"+
    "5. Activar cooldown\n6. Desactivar cooldown\n"+
    "7. Desactivar Gacha\n8. Activar Gacha\n9. Establecer Evento"
  );

  switch(opcion){
    case "1": activarLuck(2); break;
    case "2": activarLuck(4); break;
    case "3": activarLuck(6); break;
    case "4": activarLuck(8); break;
    case "5": cooldownActivo=true; alert("Cooldown activado"); break;
    case "6": cooldownActivo=false; alert("Cooldown desactivado"); break;
    case "7": gachaActivo=false; alert("Gacha desactivado"); break;
    case "8": gachaActivo=true; alert("Gacha activado"); break;
    case "9":
      let nombre = prompt("Nombre del evento:");
      eventoNombre = nombre; 
      break;
    default: alert("Opci√≥n inv√°lida"); break;
  }
  guardarConfig();
  actualizarUI();
}

function activarLuck(mult){
  luckMultiplier = mult;
  luckEndTime = Date.now() + 10*60*1000; // 10 minutos
  alert(`x${mult} Luck activado 10 minutos`);
  guardarConfig();
}

// GUARDAR CONFIGURACION
function guardarConfig(){
  config={luckMultiplier,luckEndTime,gachaActivo,cooldownActivo,eventoNombre};
  localStorage.setItem("gachaConfig",JSON.stringify(config));
}

// ACTUALIZAR CONTADOR DE LUCK
setInterval(()=>{
  if(luckEndTime){
    let restante = luckEndTime - Date.now();
    if(restante>0){
      let min = Math.floor(restante/60000);
      let seg = Math.floor((restante%60000)/1000);
      luckDiv.innerText = `x${luckMultiplier
