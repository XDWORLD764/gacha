<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>LOS COMPASITOS GACHA</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #1a1a1a, #333);
    color: white;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    height: 100vh;
    flex-direction: column;
    padding-top: 30px;
    position: relative;
  }
  h1 {
    text-align: center;
    font-size: 2em;
    color: gold;
    text-shadow: 2px 2px 4px black;
    margin-bottom: 10px;
  }
  #eventoActivo, #luckActivo {
    text-align: center;
    margin-bottom: 10px;
    font-size: 1.2em;
  }
  #luckBadge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: gold;
    color: black;
    font-weight: bold;
    padding: 8px 12px;
    border-radius: 8px;
    display: none;
    box-shadow: 0 0 10px gold;
  }
  #resultado {
    margin-top: 20px;
    font-size: 1.2em;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    min-height: 60px;
    border: 2px solid white;
  }
  button {
    padding: 15px 30px;
    font-size: 1.2em;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    color: white;
    transition: 0.3s;
    align-self: center;
    margin-top: 10px;
  }
  button:hover { opacity: 0.8; }
  #btnCodigos {
    position: absolute;
    bottom: 20px;
    left: 20px;
    background: blue;
  }
  #btnGirosSuerte {
    position: absolute;
    bottom: 20px;
    right: 20px;
    background: green;
  }
  .Comun { color: lightgray; border: 2px solid gray; padding: 5px; display:inline-block; border-radius:8px;}
  .Raro { color: purple; border: 2px solid purple; padding: 5px; display:inline-block; border-radius:8px;}
  .M√≠tico { color: red; border: 2px solid red; font-weight: bold; padding: 5px; display:inline-block; border-radius:8px;}
  .FrutaMitica { color: orange; border: 2px solid gold; padding: 5px; font-weight:bold; display:inline-block; border-radius:8px;}
  #historial, #inventario {
    margin-top: 30px;
    max-height: 200px;
    overflow-y: auto;
    border-top: 1px solid white;
    padding-top: 10px;
  }
  #historial h2, #inventario h2 { margin-bottom: 10px; font-size: 1.2em; }
  #historial ul, #inventario ul { list-style: none; padding-left: 0; display:flex; flex-wrap: wrap; gap:10px;}
  #historial li, #inventario li { margin-bottom: 5px; font-size: 1em; text-align:center; }
</style>
</head>
<body>

<h1>LOS COMPASITOS GACHA</h1>
<div id="eventoActivo"></div>
<div id="luckActivo"></div>
<div id="luckBadge"></div>

<button id="btnGirar" onclick="girar(false)">Girar</button>
<button id="btnAdmin" onclick="abrirPanel()">Panel de administraci√≥n</button>

<div id="resultado"></div>

<div id="historial">
  <h2>Historial de tus premios:</h2>
  <ul id="historial-list"></ul>
</div>

<div id="inventario">
  <h2>Inventario:</h2>
  <ul id="inventario-list"></ul>
</div>

<button id="btnCodigos" onclick="usarCodigo()">C√≥digos</button>
<button id="btnGirosSuerte" onclick="girar(true)">Giros de la Suerte</button>

<script>
let cooldownActivo = true;
let cooldownTiempo = 45 * 60 * 1000;
let luckMultiplier = 1;
let luckEndTime = null;
let gachaActivo = true;
let eventoNombre = "";
let girosSuerte = parseInt(localStorage.getItem("girosSuerte") || "0");

// Probabilidades normales
const items = [
  { nombre: "Sticker", rareza: "Comun", prob: 0.7 },
  { nombre: "Nada", rareza: "Comun", prob: 0.0 }, // opcional quitar "nada"
  { nombre: "Ayuda con algo", rareza: "Raro", prob: 0.25 },
  { nombre: "Objeto M√≠tico", rareza: "M√≠tico", prob: 0.049 },
  { nombre: "Fruta M√≠tica", rareza: "FrutaMitica", prob: 0.001 }
];

// Probabilidades en giros de la suerte
const itemsSuerte = [
  { nombre: "Sticker Premium", rareza: "Comun", prob: 0.4 },
  { nombre: "Ayuda Extra", rareza: "Raro", prob: 0.4 },
  { nombre: "Objeto M√≠tico", rareza: "M√≠tico", prob: 0.18 },
  { nombre: "Fruta M√≠tica", rareza: "FrutaMitica", prob: 0.02 }
];

function girar(esSuerte){
  const resultadoDiv = document.getElementById("resultado");
  if(!gachaActivo){
    resultadoDiv.innerText = "‚ùå No Hay Eventos Activos";
    return;
  }

  if(esSuerte && girosSuerte <= 0){
    alert("No tienes giros de la suerte disponibles.");
    return;
  }

  let historial = JSON.parse(localStorage.getItem("historialGacha") || "[]");

  if(!esSuerte && cooldownActivo){
    let lastSpin = localStorage.getItem("lastSpin");
    let now = Date.now();
    if(lastSpin && now - lastSpin < cooldownTiempo){
      let restante = Math.ceil((cooldownTiempo - (now - lastSpin)) / 60000);
      resultadoDiv.innerText = "‚è≥ Espera " + restante + " minutos para girar de nuevo.";
      return;
    }
    localStorage.setItem("lastSpin", Date.now());
  }

  // Animaci√≥n tipo gacha
  let vueltas = 20;
  let i = 0;
  const animacion = setInterval(()=>{
    let pool = esSuerte ? itemsSuerte : items;
    let randomItem = pool[Math.floor(Math.random() * pool.length)];
    resultadoDiv.innerHTML = `<span class="${randomItem.rareza}">${randomItem.nombre}</span>`;
    i++;
    if(i>=vueltas){
      clearInterval(animacion);

      // Calcular item final con Luck
      let pool = esSuerte ? itemsSuerte : items;
      let totalProb = pool.reduce((acc, item)=>{
        let probAjustada = item.prob;
        if(item.rareza === "Raro") probAjustada *= luckMultiplier;
        if(item.rareza === "M√≠tico" || item.rareza === "FrutaMitica") probAjustada *= luckMultiplier * 2;
        return acc + probAjustada;
      },0);

      let rand = Math.random() * totalProb;
      let acumulado = 0;
      let finalItem;
      for(let item of pool){
        let probAjustada = item.prob;
        if(item.rareza === "Raro") probAjustada *= luckMultiplier;
        if(item.rareza === "M√≠tico" || item.rareza === "FrutaMitica") probAjustada *= luckMultiplier * 2;
        acumulado += probAjustada;
        if(rand <= acumulado){
          finalItem = item;
          break;
        }
      }
      if(!finalItem) finalItem = pool[0];

      if(esSuerte) {
        girosSuerte--;
        localStorage.setItem("girosSuerte", girosSuerte);
      }

      // Preguntar Guardar o Desechar
      let accion = confirm(`üéÅ Has obtenido: ${finalItem.nombre} (${finalItem.rareza})\nDeseas GUARDARlo? Cancelar = Desechar`);
      if(accion){
        let inventario = JSON.parse(localStorage.getItem("inventario") || "[]");
        inventario.push(finalItem);
        localStorage.setItem("inventario", JSON.stringify(inventario));
        alert("¬°Guardado en tu inventario!");
      }

      historial.unshift({nombre: finalItem.nombre, rareza: finalItem.rareza, fecha: new Date().toLocaleString()});
      localStorage.setItem("historialGacha", JSON.stringify(historial));
      mostrarHistorial();
      mostrarInventario();
    }
  }, 100);
}

function usarCodigo(){
  let code = prompt("Introduce un c√≥digo:");
  if(["AsierEsElMasPro","QuintumaFANTASY","TheNoliEventIsCrazy"].includes(code)){
    girosSuerte++;
    localStorage.setItem("girosSuerte", girosSuerte);
    alert("‚úÖ C√≥digo v√°lido. Ahora tienes "+girosSuerte+" Giros de la Suerte.");
  } else {
    alert("‚ùå C√≥digo inv√°lido.");
  }
}

function mostrarHistorial(){
  let historial = JSON.parse(localStorage.getItem("historialGacha") || "[]");
  let lista = document.getElementById("historial-list");
  lista.innerHTML = "";
  historial.forEach(item=>{
    let li = document.createElement("li");
    li.innerHTML = `<span class="${item.rareza}">${item.nombre}</span>`;
    lista.appendChild(li);
  });
}

function mostrarInventario(){
  let inventario = JSON.parse(localStorage.getItem("inventario") || "[]");
  let lista = document.getElementById("inventario-list");
  lista.innerHTML = "";
  inventario.forEach(item=>{
    let li = document.createElement("li");
    li.innerHTML = `<span class="${item.rareza}">${item.nombre}</span>`;
    lista.appendChild(li);
  });
}

function abrirPanel(){
  let pass = prompt("Inserta la contrase√±a:");
  if(pass === "HolaXD"){
    let opcion = prompt(
      "Elige opci√≥n:\n"+
      "1. x2 Luck\n2. x4 Luck\n3. x6 Luck\n4. x8 Luck\n"+
      "5. Activar cooldown\n6. Desactivar cooldown\n"+
      "7. Desactivar Gacha\n8. Activar Gacha\n9. Establecer Evento"
    );
    switch(opcion){
      case "1": activarLuck(2); break;
      case "2": activarLuck(4); break;
      case "3": activarLuck(6); break;
      case "4": activarLuck(8); break;
      case "5": cooldownActivo = true; alert("Cooldown activado"); break;
      case "6": cooldownActivo = false; alert("Cooldown desactivado"); break;
      case "7": gachaActivo = false; alert("Gacha desactivado"); break;
      case "8": gachaActivo = true; alert("Gacha activado"); break;
      case "9":
        let nombre = prompt("Nombre del evento:");
        eventoNombre = nombre;
        document.getElementById("eventoActivo").innerText = "Evento Activo: "+eventoNombre;
        break;
      default: alert("Opci√≥n inv√°lida"); break;
    }
  } else alert("Contrase√±a incorrecta");
}

function activarLuck(mult){
  luckMultiplier = mult;
  luckEndTime = Date.now() + 10*60*1000; // duraci√≥n 10 minutos
  document.getElementById("luckActivo").innerText = `x${mult} Luck activo se acaba en 10:00`;
  document.getElementById("luckBadge").style.display = "block";
  document.getElementById("luckBadge").innerText = `X${mult} SUERTE`;
  alert(`Luck x${mult} activado`);
}

// Actualizar contador de luck
setInterval(()=>{
  if(luckEndTime){
    let restante = luckEndTime - Date.now();
    if(restante > 0){
      let min = Math.floor(restante/60000);
      let seg = Math.floor((restante%60000)/1000);
      document.getElementById("luckActivo").innerText = `x${luckMultiplier} Luck activo se acaba en ${min}:${seg<10?'0'+seg:seg}`;
    } else {
      luckMultiplier = 1;
      luckEndTime = null;
      document.getElementById("luckActivo").innerText = "";
      document.getElementById("luckBadge").style.display = "none";
    }
  }
}, 1000);

window.onload = ()=>{
  mostrarHistorial();
  mostrarInventario();
};
</script>
</body>
</html>
